## Bridger

[![CI](https://github.com/darwinia-network/bridger/workflows/CI/badge.svg)](https://github.com/darwinia-network/bridger/actions)
[![crate](https://img.shields.io/crates/v/darwinia-bridger.svg)](https://crates.io/crates/darwinia-bridger)
[![doc](https://img.shields.io/badge/current-docs-brightgreen.svg)](https://docs.rs/darwinia-bridger/)
[![downloads](https://img.shields.io/crates/d/darwinia-bridger.svg)](https://crates.io/crates/darwinia-bridger)
[![LICENSE](https://img.shields.io/crates/l/darwinia-bridger.svg)](https://choosealicense.com/licenses/gpl/)

Darwinia Bridger is the Darwinia relayer client and watchtower written in Rust.

## Installation

### Download from GitHub releases

Download the binary from [latest release](https://github.com/darwinia-network/bridger/releases/latest).

### ~Install using cargo~

> ⚠️ This method is temporarily unavailable due to #76.

```
$ cargo install darwinia-bridger
```

### Build from source

> Note: rustc toolchain `nightly-2020-10-06` will be installed along with this package, see <https://github.com/paritytech/substrate/issues/7282>. You might want to change the default toolchain using `rustup default nightly-2020-10-06`.

```bash
git clone https://github.com/darwinia-network/bridger.git
cd bridger/
cargo build --release
cd target/release/
./bridger run -v
```

## Configuration

`Bridger` depends on a TOML config file, it is located in `~/.bridger/config.toml` by default.

Sample configs:

- For mainnet: [.maintain/config/mainnet.toml.sample](.maintain/config/mainnet.toml.sample)
- For testnet (Ropsten and Crab): [.maintain/config/ropsten_crab.toml.sample](.maintain/config/ropsten_crab.toml.sample)

The config file can be generated by executing any subcommand, such as `bridger run` and `bridger keys`. Thus, you don't need to manually create the file, but it is required to update a few fields:

#### `node`

The WebSocket endpoint of Darwinia official node or any archive node (`darwinia --pruning=archive`), supports `ws://` and `wss://`. For example:

```toml
node = "wss://cc1.darwinia.network"
```

#### `shadow`

The endpoint of [Darwinia Shadow service](https://github.com/darwinia-network/shadow), supports HTTP and HTTPS, for example using the official service:

```toml
shadow = "https://shadow.darwinia.network"
```

#### `eth.rpc`

The endpoint of Ethereum RPC. You can use the public geth hosted by Darwinia, your self-hosted node, or any third-party Ethereum RPC service, such as Infura and Alchemy. For example:

```toml
[eth]
rpc = "https://mainnet.geth.darwinia.network"
```

#### `seed`

Private key in hex of your account or proxy account to sign relay extrinsics. It is highly recommended to use a proxy account to prevent exposing your main account's private key. Proxy account is an account that can "perform" on behalf of your "real" account. **To allow an account proxying extrinsics, you need to open [Extrinsics in apps.darwinia.network](https://apps.darwinia.network/#/extrinsics), switch to your "real" account, and submit the `proxy.addProxy(proxy_account, ProxyType.EthereumBridge, 0)` extrinsic to delegate it.** For example:

```toml
seed = "0x0000000000000000000000000000000000000000000000000000000000000000"
```

#### `proxy.real`

**If you set `seed` to the private key of your proxy account, you have to set this to the public key of your "real" account as well.** For example:

```toml
[proxy]
real = "0x0000000000000000000000000000000000000000000000000000000000000000"
```

Here is a [tool](https://polkadot.subscan.io/tools/ss58_transform) provided by Subscan that helps convert SS58 addresses to public keys. Comment out this field if you don't want to use proxy account.

## Usage

The latest help texts are also available in `bridger --help`.

```
$ bridger
darwinia-bridger 0.3.0

USAGE:
    bridger <SUBCOMMAND>

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

SUBCOMMANDS:
    affirm          Affirm one target block
    affirm-raw      Affirm a raw parcel from json str
    affirmations    List affirmations from chain
    confirm         Set Confirmed block with sudo privilege
    guard           Run `guard` service standalone
    help            Prints this message or the help of the given subcommand(s)
    keys            Show sudo and technical committee members' public key
    run             Run the bridger, this will start `ethereum`, `relay`, `redeem` and `guard` services
    set-start       Set where to start the ethereum scan
    show-parcel     Show a parcel from ethereum
```

- `bridger run` starts the full-functional bridger. You can also use ```bridger run -v``` to enter verbose mode which prints more trace logs.

- `bridger guard` only starts the standalone guard service.

## License

GPL-3.0
